\begin{tikzpicture}[
    x=(215:2em/sqrt 2), y=(0:2em), z=(90:2em),
    declare function={f(\x,\y)=((\x-3)^2+(-\y+3)^3)/8+3;},  % f defines surface
    declare function={dfx(\x,\y)=(2*(\x-3))/8;},            % x coordinate of gradient of surface
    declare function={dfy(\x,\y)=(-3*(-\y+3)^2)/8;},        % y coordinate of gradient of surface
    declare function={cx(\t)= 3*(1-\t)^2 + 2*\t;},
    declare function={cy(\t)= 2*(1-\t) + 4*\t;},
    scale=2.5
]
%  \draw [-stealth, black!75] (0,0,0) -- (5,0,0) node [below left] {$x$};
%  \draw [-stealth, black!75] (0,0,0) -- (0,5,0) node [below right] {$y$};
%  \draw [-stealth, black!75] (0,0,0) -- (0,0,5) node [right] {$z$};

  \foreach \x in {1,...,4}
  \foreach \y in {1,...,4}{
    \draw [thin,black, fill=black, fill opacity=0.02,
    domain=0:1, samples=10, variable=\t] 
    plot (\x+\t, \y, {f(\x+\t,\y)}) -- 
    plot (\x+1, \y+\t, {f(\x+1,\y+\t)}) -- 
    plot (\x+1-\t, \y+1, {f(\x+1-\t,\y+1)}) --
    plot (\x, \y+1-\t, {f(\x,\y+1-\t)}) -- cycle;
  }

  \node at (5,2,{f(5,2)}) [below left] {$x^1$};
  \node at (2,5,{f(2,5)}) [below right] {$x^2$};


  % Point at p
  \coordinate (p) at (2,4,{f(2,4)});
  \node at (p) [below] {$p$};
  \fill (p) circle [radius=1pt];

  % Tangent plane at  p
  \coordinate (p1) at ($ (p) + ( 0.5, 0.5, {dfx(2,4)* 0.5 + dfy(2,4)* 0.5})  $);
  \coordinate (p2) at ($ (p) + (-0.5, 0.5, {dfx(2,4)*-0.5 + dfy(2,4)* 0.5})  $);
  \coordinate (p3) at ($ (p) + (-0.5,-0.5, {dfx(2,4)*-0.5 + dfy(2,4)*-0.5})  $);
  \coordinate (p4) at ($ (p) + ( 0.5,-0.5, {dfx(2,4)* 0.5 + dfy(2,4)*-0.5})  $);
  \draw [black, fill=black, fill opacity=0.125] (p1) -- (p2) -- (p3) -- (p4) -- cycle;
  \node at (p2) [above] {$T_p$};

  % Point at q
  \coordinate (q)  at (3,2,{f(3,2)});
  \fill (q) circle [radius=1pt];
  \node at (q) [below] {$q$};

  % Tangent plane at  p
  \coordinate (q1) at ($ (q) + ( 0.5, 0.5, {dfx(3,2)* 0.5 + dfy(3,2)* 0.5})  $);
  \coordinate (q2) at ($ (q) + (-0.5, 0.5, {dfx(3,2)*-0.5 + dfy(3,2)* 0.5})  $);
  \coordinate (q3) at ($ (q) + (-0.5,-0.5, {dfx(3,2)*-0.5 + dfy(3,2)*-0.5})  $);
  \coordinate (q4) at ($ (q) + ( 0.5,-0.5, {dfx(3,2)* 0.5 + dfy(3,2)*-0.5})  $);
  \draw [black, fill=black, fill opacity=0.125] (q1) -- (q2) -- (q3) -- (q4) -- cycle;
  \node at (q3) [above] {$T_q$};

  % curve gamma
    \draw [black, very thick, domain=0:1, variable=\t,samples=20] 
    plot ({cx(\t)},{cy(\t)}, {f({cx(\t)},{cy(\t)})});
    \node at ({cx(0.4)},{cy(0.4)},{f({cx(0.4)},{cy(0.4)})}) [above] {$\gamma$};

\end{tikzpicture}
